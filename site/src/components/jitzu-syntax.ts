// Custom Jitzu syntax highlighting themes
export const jitzuSyntaxLight = {
  'code[class*="language-"]': {
    color: '#2d1b0e',
    background: 'transparent',
    fontFamily: 'JetBrains Mono, Consolas, Monaco, "Andale Mono", monospace',
    fontSize: '0.875rem',
    lineHeight: '1.6',
    direction: 'ltr' as const,
    textAlign: 'left' as const,
    whiteSpace: 'pre' as const,
    wordSpacing: 'normal' as const,
    wordBreak: 'normal' as const,
    tabSize: 4,
    hyphens: 'none' as const
  },
  'pre[class*="language-"]': {
    color: '#2d1b0e',
    background: 'transparent',
    fontFamily: 'JetBrains Mono, Consolas, Monaco, "Andale Mono", monospace',
    fontSize: '0.875rem',
    lineHeight: '1.6',
    direction: 'ltr' as const,
    textAlign: 'left' as const,
    whiteSpace: 'pre' as const,
    wordSpacing: 'normal' as const,
    wordBreak: 'normal' as const,
    tabSize: 4,
    hyphens: 'none' as const,
    padding: '1em',
    margin: '0.5em 0',
    overflow: 'auto' as const
  },
  comment: {
    color: '#8b4513',
    fontStyle: 'italic' as const
  },
  prolog: {
    color: '#8b4513',
    fontStyle: 'italic' as const
  },
  doctype: {
    color: '#8b4513',
    fontStyle: 'italic' as const
  },
  cdata: {
    color: '#8b4513',
    fontStyle: 'italic' as const
  },
  keyword: {
    color: '#663399',
    fontWeight: 'bold' as const
  },
  property: {
    color: '#990055'
  },
  tag: {
    color: '#990055'
  },
  symbol: {
    color: '#990055'
  },
  deleted: {
    color: '#cc0000'
  },
  important: {
    color: '#cc0000',
    fontWeight: 'bold' as const
  },
  string: {
    color: '#669900'
  },
  char: {
    color: '#669900'
  },
  number: {
    color: '#ff6600'
  },
  boolean: {
    color: '#ff6600'
  },
  constant: {
    color: '#ff6600'
  },
  function: {
    color: '#dd4a68'
  },
  'function-name': {
    color: '#dd4a68'
  },
  method: {
    color: '#dd4a68'
  },
  'class-name': {
    color: '#e90'
  },
  type: {
    color: '#e90'
  },
  selector: {
    color: '#669900'
  },
  'attr-name': {
    color: '#669900'
  },
  builtin: {
    color: '#669900'
  },
  inserted: {
    color: '#669900'
  },
  operator: {
    color: '#a67f59'
  },
  entity: {
    color: '#a67f59'
  },
  url: {
    color: '#a67f59'
  },
  variable: {
    color: '#a67f59'
  },
  punctuation: {
    color: '#999999'
  },
  atrule: {
    color: '#e90'
  },
  'attr-value': {
    color: '#e90'
  },
  regex: {
    color: '#ee9900'
  },
  bold: {
    fontWeight: 'bold' as const
  },
  italic: {
    fontStyle: 'italic' as const
  }
};

export const jitzuSyntaxDark = {
  'code[class*="language-"]': {
    color: '#f4f4f4',
    background: 'transparent',
    fontFamily: 'JetBrains Mono, Consolas, Monaco, "Andale Mono", monospace',
    fontSize: '0.875rem',
    lineHeight: '1.6',
    direction: 'ltr' as const,
    textAlign: 'left' as const,
    whiteSpace: 'pre' as const,
    wordSpacing: 'normal' as const,
    wordBreak: 'normal' as const,
    tabSize: 4,
    hyphens: 'none' as const
  },
  'pre[class*="language-"]': {
    color: '#f4f4f4',
    background: 'transparent',
    fontFamily: 'JetBrains Mono, Consolas, Monaco, "Andale Mono", monospace',
    fontSize: '0.875rem',
    lineHeight: '1.6',
    direction: 'ltr' as const,
    textAlign: 'left' as const,
    whiteSpace: 'pre' as const,
    wordSpacing: 'normal' as const,
    wordBreak: 'normal' as const,
    tabSize: 4,
    hyphens: 'none' as const,
    padding: '1em',
    margin: '0.5em 0',
    overflow: 'auto' as const
  },
  comment: {
    color: '#b8860b',
    fontStyle: 'italic' as const
  },
  prolog: {
    color: '#b8860b',
    fontStyle: 'italic' as const
  },
  doctype: {
    color: '#b8860b',
    fontStyle: 'italic' as const
  },
  cdata: {
    color: '#b8860b',
    fontStyle: 'italic' as const
  },
  keyword: {
    color: '#dda0dd',
    fontWeight: 'bold' as const
  },
  property: {
    color: '#ff69b4'
  },
  tag: {
    color: '#ff69b4'
  },
  symbol: {
    color: '#ff69b4'
  },
  deleted: {
    color: '#ff6b6b'
  },
  important: {
    color: '#ff6b6b',
    fontWeight: 'bold' as const
  },
  string: {
    color: '#98fb98'
  },
  char: {
    color: '#98fb98'
  },
  number: {
    color: '#ffa500'
  },
  boolean: {
    color: '#ffa500'
  },
  constant: {
    color: '#ffa500'
  },
  function: {
    color: '#f08080'
  },
  'function-name': {
    color: '#f08080'
  },
  method: {
    color: '#f08080'
  },
  'class-name': {
    color: '#ffd700'
  },
  type: {
    color: '#ffd700'
  },
  selector: {
    color: '#98fb98'
  },
  'attr-name': {
    color: '#98fb98'
  },
  builtin: {
    color: '#98fb98'
  },
  inserted: {
    color: '#98fb98'
  },
  operator: {
    color: '#deb887'
  },
  entity: {
    color: '#deb887'
  },
  url: {
    color: '#deb887'
  },
  variable: {
    color: '#deb887'
  },
  punctuation: {
    color: '#cccccc'
  },
  atrule: {
    color: '#ffd700'
  },
  'attr-value': {
    color: '#ffd700'
  },
  regex: {
    color: '#ffcc00'
  },
  bold: {
    fontWeight: 'bold' as const
  },
  italic: {
    fontStyle: 'italic' as const
  }
};

// Enhanced function to highlight Jitzu code manually
export function highlightJitzuCode(code: string, isDark: boolean = false): string {
  const theme = isDark ? jitzuSyntaxDark : jitzuSyntaxLight;

  // Don't escape HTML - we'll be more careful with our patterns
  let highlightedCode = code;

  // Create a safe replacement function that preserves content
  const safeReplace = (regex: RegExp, replacer: (match: string, ...args: any[]) => string) => {
    const matches: Array<{ match: string, replacement: string, index: number }> = [];
    let match;
    regex.lastIndex = 0; // Reset regex

    while ((match = regex.exec(highlightedCode)) !== null) {
      matches.push({
        match: match[0],
        replacement: replacer(match[0], ...match.slice(1)),
        index: match.index!
      });
      if (!regex.global) break;
    }

    // Apply replacements in reverse order to preserve indices
    matches.reverse().forEach(({ match, replacement, index }) => {
      highlightedCode = highlightedCode.substring(0, index) + replacement + highlightedCode.substring(index + match.length);
    });
  };

  // Comments first (so they don't interfere with other patterns)
  safeReplace(/\/\*[\s\S]*?\*\//g, (match) =>
    `<span style="color: ${theme.comment.color}; font-style: ${theme.comment.fontStyle}">${match}</span>`
  );

  safeReplace(/\/\/.*$/gm, (match) =>
    `<span style="color: ${theme.comment.color}; font-style: ${theme.comment.fontStyle}">${match}</span>`
  );

  // Strings (template literals first)
  safeReplace(/`[^`]*`/g, (match) => {
    return `<span style="color: ${theme.string.color}">${match}</span>`;
  });

  safeReplace(/"[^"]*"/g, (match) =>
    `<span style="color: ${theme.string.color}">${match}</span>`
  );

  safeReplace(/'[^']*'/g, (match) =>
    `<span style="color: ${theme.string.color}">${match}</span>`
  );

  // Numbers and booleans
  safeReplace(/\b(?:0x[\da-f]+|0b[01]+|(?:\d+\.?\d*|\.\d+)(?:e[+-]?\d+)?[fl]?)\b/gi, (match) =>
    `<span style="color: ${theme.number.color}">${match}</span>`
  );

  safeReplace(/\b(true|false)\b/g, (match) =>
    `<span style="color: ${theme.boolean.color}">${match}</span>`
  );

  // Function calls
  safeReplace(/\b([a-zA-Z_]\w*)\s*(?=\()/g, (_, funcName) =>
    `<span style="color: ${theme.function.color}">${funcName}</span>`
  );

  // Type names (starting with capital letter)
  safeReplace(/\b[A-Z][a-zA-Z0-9_]*\b/g, (match) => {
    return `<span style="color: ${theme['class-name'].color}">${match}</span>`;
  });

  // Keywords (comprehensive list)
  safeReplace(/\b(let|mut|const|fun|return|if|else|match|case|for|while|in|try|catch|finally|defer|async|await|yield|break|continue|enum|trait|impl|type|open|import|package|static|pub|public|private|internal|override|abstract|virtual|sealed|partial|where|when|is|as|new|delete|this|super|null|and|or|not|xor|mod|div|assert|like)\b/g, (match) => {
    return `<span style="color: ${theme.keyword.color}; font-weight: ${theme.keyword.fontWeight}">${match}</span>`;
  });

  return highlightedCode;
}
