---
import { navMain } from '@/lib/navigation';

const currentPath = Astro.url.pathname;

function isActive(url: string): boolean {
  return currentPath === url || currentPath === url + '/';
}

function sectionHasActive(items?: { url: string }[]): boolean {
  return items?.some(item => isActive(item.url)) ?? false;
}
---

<aside id="sidebar" class="sidebar-container">
  {/* Mobile overlay */}
  <label for="sidebar-toggle" class="sidebar-overlay"></label>

  <nav class="sidebar-nav">
    <div class="px-4 py-4 border-b border-sidebar-border">
      <a href="/" class="flex flex-col gap-0.5 leading-none">
        <span class="text-gradient-primary font-bold text-lg">Jitzu</span>
        <span class="text-xs text-muted-foreground">Documentation</span>
      </a>
    </div>

    <div class="px-2 py-4 space-y-1 overflow-y-auto flex-1">
      {navMain.map((section) => (
        <details class="group" open={sectionHasActive(section.items) || section.title === "Getting Started"}>
          <summary class="flex items-center justify-between px-3 py-2 text-xs uppercase tracking-wider font-medium text-muted-foreground cursor-pointer select-none hover:text-foreground transition-colors list-none [&::-webkit-details-marker]:hidden">
            {section.title}
            <svg class="size-3 transition-transform group-open:rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path d="M9 5l7 7-7 7" />
            </svg>
          </summary>
          {section.items && (
            <ul class="mt-1 ml-3 space-y-0.5 border-l border-sidebar-border pl-3">
              {section.items.map((item) => (
                <li>
                  <a
                    href={item.url}
                    class:list={[
                      'block px-3 py-1.5 text-sm rounded-md transition-colors',
                      isActive(item.url)
                        ? 'text-foreground bg-sidebar-accent font-medium'
                        : 'text-muted-foreground hover:text-foreground hover:bg-sidebar-accent/50',
                    ]}
                  >
                    {item.title}
                  </a>
                </li>
              ))}
            </ul>
          )}
        </details>
      ))}
    </div>
  </nav>
</aside>

<style>
  .sidebar-container {
    position: fixed;
    top: 0;
    left: 0;
    bottom: 0;
    width: 280px;
    z-index: 40;
    transition: transform 0.3s ease;
  }

  .sidebar-nav {
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--sidebar);
    border-right: 1px solid var(--sidebar-border);
  }

  .sidebar-overlay {
    display: none;
  }

  /* Mobile: hidden by default, shown when checkbox checked */
  @media (max-width: 1023px) {
    .sidebar-container {
      transform: translateX(-100%);
    }

    :global(#sidebar-toggle:checked) ~ #sidebar {
      transform: translateX(0);
    }

    :global(#sidebar-toggle:checked) ~ #sidebar .sidebar-overlay {
      display: block;
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.5);
      z-index: -1;
    }
  }

  /* Desktop: always visible */
  @media (min-width: 1024px) {
    .sidebar-container {
      transform: translateX(0);
    }
  }
</style>
